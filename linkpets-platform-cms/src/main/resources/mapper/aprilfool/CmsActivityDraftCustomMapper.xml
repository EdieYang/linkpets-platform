<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.linkpets.cms.aprilfool.dao.CmsActivityDraftCustomMapper">
    <resultMap id="BaseResultMap" type="com.linkpets.core.model.CmsActivityDraft">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Tue Mar 26 16:04:35 CST 2019.
        -->
        <id column="draft_id" jdbcType="VARCHAR" property="draftId"/>
        <result column="activity_id" jdbcType="VARCHAR" property="activityId"/>
        <result column="user_id" jdbcType="VARCHAR" property="userId"/>
        <result column="draft_status" jdbcType="INTEGER" property="draftStatus"/>
        <result column="draft_time" jdbcType="TIMESTAMP" property="draftTime"/>
        <result column="create_time" jdbcType="TIMESTAMP" property="createTime"/>
        <result column="is_valid" jdbcType="INTEGER" property="isValid"/>
    </resultMap>
    <sql id="Base_Column_List">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Tue Mar 26 16:04:35 CST 2019.
        -->
        draft_id, activity_id, user_id, draft_status, draft_time, create_time, is_valid
    </sql>
    <select id="getActivityDraftExistNoByUserId" parameterType="java.lang.String" resultType="java.lang.Integer">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Tue Mar 26 16:04:35 CST 2019.
        -->
        select
        count(draft_id)
        from cms_activity_draft
        where activity_id = #{activityId,jdbcType=VARCHAR}
        and user_id = #{userId}
        and draft_status = 0
        and is_valid = 1

    </select>

    <select id="getActivityDraftCount" parameterType="java.lang.String" resultType="java.lang.Integer">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Tue Mar 26 16:04:35 CST 2019.
        -->
        select
        count(draft_id)
        from cms_activity_draft
        where activity_id = #{activityId,jdbcType=VARCHAR}
        and user_id = #{userId}
        and is_valid = 1

    </select>

    <select id="getActivityCouponDraftListByUserId" parameterType="java.lang.String"
            resultType="com.linkpets.cms.aprilfool.model.CmsActivityCustomDraft">
        select ad.draft_id as draftId,
        ad.activity_id as activityId,
        ad.user_id as userId,
        ad.draft_time as draftTime,
        ad.create_time as createTime,
        ad.is_valid as isValid,
        ad.present_id as presentId,
        ad.present_type as presentType,
        cc.coupon_name as presentName,
        so.org_name as publishOrgName
        from cms_activity_draft ad
        left join cms_coupon_batch_item cbi
        on ad.present_id = cbi.coupon_item_id
        left join cms_coupon_batch cb
        on cbi.batch_no = cb.batch_no
        left join cms_coupon cc
        on cb.coupon_id = cc.coupon_id
        left join sys_org so
        on cc.org_id = so.org_id
        where ad.draft_status = 0
        <if test="presentType!='' and presentType!=null">
            and ad.present_type = #{presentType}
        </if>
        and ad.activity_id = #{activityId}
        and ad.user_id = #{userId}
        and ad.is_valid = 1
    </select>

    <select id="getActivityCouponDraftByDraftId" parameterType="java.lang.String"
            resultType="com.linkpets.cms.aprilfool.model.CmsActivityCustomDraft">
    select ad.draft_id as draftId,
           ad.activity_id as activityId,
           ad.user_id as userId,
           ad.draft_status as draftStatus,
           ad.draft_time as draftTime,
           ad.create_time as createTime,
           ad.is_valid as isValid,
           ad.present_id as presentId,
           ad.present_type as presentType,
           cc.coupon_name as presentName,
           so.org_name as publishOrgName,
           cc.coupon_type as couponType
    from cms_activity_draft ad
    left join cms_coupon_batch_item cbi
    on ad.present_id = cbi.coupon_item_id
    left join cms_coupon_batch cb
    on cbi.batch_no = cb.batch_no
    left join cms_coupon cc
    on cb.coupon_id = cc.coupon_id
    left join sys_org so
    on cc.org_id = so.org_id
    where ad.draft_status = 1
    and ad.draft_id = #{draftId}
    and ad.is_valid = 1
  </select>

    <select id="getActivityDraftListByUserId" parameterType="java.lang.String" resultMap="BaseResultMap">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Tue Mar 26 16:04:35 CST 2019.
        -->
        select
        <include refid="Base_Column_List"/>
        from cms_activity_draft
        where activity_id = #{activityId,jdbcType=VARCHAR}
        and user_id = #{userId}
        and draft_status = 1
        and is_valid = 1

    </select>

    <select id="getActivityUnDraftedRecordByUserId" parameterType="java.lang.String" resultMap="BaseResultMap">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Tue Mar 26 16:04:35 CST 2019.
        -->
        select
        <include refid="Base_Column_List"/>
        from cms_activity_draft
        where activity_id = #{activityId,jdbcType=VARCHAR}
        and user_id = #{userId}
        and draft_status = 0
        and is_valid = 1
        limit 1

    </select>

</mapper>