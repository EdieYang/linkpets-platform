<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.linkpets.cms.manage.dao.SysUserCustomMapper">
    <resultMap id="BaseResultMap" type="com.linkpets.cms.manage.model.SysUserCustom">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Fri Mar 15 18:55:21 CST 2019.
        -->
        <id column="user_id" property="userId" jdbcType="VARCHAR"/>
        <result column="user_name" property="userName" jdbcType="VARCHAR"/>
        <result column="role_type" property="roleType" jdbcType="INTEGER"/>
        <result column="role_id" property="roleId" jdbcType="VARCHAR"/>
        <result column="is_active" property="isActive" jdbcType="INTEGER"/>
        <result column="chain_id" property="chainId" jdbcType="VARCHAR"/>
        <result column="chain_name" property="chainName" jdbcType="VARCHAR"/>
        <result column="org_id" property="orgId" jdbcType="VARCHAR"/>
        <result column="org_name" property="orgName" jdbcType="VARCHAR"/>
        <result column="open_id" property="openId" jdbcType="VARCHAR"/>
        <result column="create_time" property="createTime" jdbcType="TIMESTAMP"/>
        <result column="update_time" property="updateTime" jdbcType="TIMESTAMP"/>
        <result column="is_valid" property="isValid" jdbcType="INTEGER"/>
    </resultMap>


    <select id="listSysUserCustom" parameterType="String" resultType="com.linkpets.cms.manage.model.SysUserCustom">

        SELECT u.user_id as userId,
        u.user_name as userName,
        u.role_id as roleId,
        r.role_type as roleType,
        u.chain_id as chainId,
        c.chain_name as chainName,
        o.org_id as orgId,
        o.org_name as orgName,
        u.open_id as openId,
        u.is_active as isActive,
        u.create_time as createTime,
        u.is_valid as isValid
        FROM sys_user u
        LEFT JOIN sys_role r
        ON u.role_id= r.role_id
        LEFT JOIN sys_chain c
        ON u.chain_id= c.chain_id
        LEFT JOIN sys_org o
        ON o.org_id = c.org_id
        WHERE 1=1
        <if test="orgId !=null and orgId !='' ">
            AND o.org_id=#{orgId}
        </if>
        <if test="chainId !=null and chainId !='' ">
            AND u.chain_id=#{chainId}
        </if>
        AND u.is_valid = 1
        ORDER BY u.create_time DESC

    </select>

    <select id="getSysUserByUserName" parameterType="String" resultType="com.linkpets.cms.manage.model.SysUserCustom">

        SELECT  u.user_id as userId,
                u.user_name as userName,
                u.password as password,
                u.role_id as roleId,
                r.role_type as roleType,
                u.chain_id as chainId,
                c.chain_name as chainName,
                o.org_id as orgId,
                o.org_name as orgName,
                u.open_id as openId,
                u.is_active as isActive,
                u.create_time as createTime,
                u.is_valid as isValid
                FROM sys_user u
                LEFT JOIN sys_role r
                ON u.role_id= r.role_id
                LEFT JOIN sys_chain c
                ON u.chain_id= c.chain_id
                LEFT JOIN sys_org o
                ON o.org_id = c.org_id
                WHERE 1=1
                <if test="userName!='' and userName !=null ">
                  AND   u.user_name=#{userName}
                </if>
                  AND u.is_valid=1

    </select>

</mapper>